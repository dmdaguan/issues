<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{{title}} - pending issues</title>

    <!-- Bootstrap -->
    <link href="/static/css/bootstrap.min.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <style>
      #myChart {
        width: 100%;
        height: 300px;
      }
      .relative-td {
        position: relative;
        font-weight: bold;
      }
      .fill-td {
        position: absolute;
        top: 0px;
        background: rgba(152, 200, 246, 0.8) none repeat scroll 0% 0%;
        bottom: 0px;
        width: 90%;
        left: 0px;
        z-index: -1;
      }
      .panel-title {
        font-size: 14px;
      }
      .panel-title a {
        color: #666;
        font-size: 0.8em;
      }
      a.repo-link {
        color: #666;
        font-size: 0.8em;
        text-decoration: none;
        font-weight: normal;
      }
      .panel-footer {
        font-size: 0.8em;
      }
      .grey {
        color: #666;
      }
      /*
      ul {
        list-style: none;
      } */
    </style>
    <script type="text/javascript">
      var allIssues = {{& allIssues}};
    </script>
  </head>
  <body>
    <div class="container">
      <h2><u>Deadline:</u> <span class="grey">{{deadline}}</span></h2>
      <div class="container">
        <div class="row">
          <div class="col-md-4">
            <p>
              <b>Time left:</b> {{daysLeft}} days
            </p>
          </div>
          <div class="col-md-4">
            <p>
              <b>Total:</b> {{totalTasks}} tasks
            </p>
          </div>
          <div class="col-md-4">
            <p>
              <b>Required:</b> {{runRate}} tasks/day
            </p>
          </div>
        </div>
      </div>
      <hr/>
      <div class="container">
        <canvas id="myChart"></canvas>
      </div>
      <h2><u>People</u></h2>
      <div class="container">
        <div class="row">
          <div class="col-md-4">
            <table class="table">
              <tbody>
                {{#people}}
                  <tr>
                    <td class="relative-td">
                      <div class="fill-td" style="width: {{width}}%;"></div>
                      <a href="/milestone/{{milestone}}?user={{name}}">{{name}}</a>
                    </td>
                    <td>{{number}}</td>
                  </tr>
                {{/people}}
              </tbody>
            </table>
          </div>
        </div>
      </div>
      <hr/>
      <div class="row">
        <div class="col-md-6">
          <h2><u>Gitlab ({{totalGitlab}})</u></h2>
          <div class="container-fluid" id="allGitlab">
            {{#gitlab}}
              <h4>
                <a role="button" data-toggle="collapse" data-parent="#allGitlab" href="#gitlab-{{projectNo}}" aria-expanded="true" aria-controls="gitlab-{{projectNo}}">
                  {{project}}  ({{noIssues}})
                </a>&nbsp;&nbsp;
                &nbsp;&nbsp;&nbsp;<a target="_blank" href="{{milestone.url}}" class="repo-link">View on Gitlab</a>
              </h4>
              <div class="container-fluid collapse{{expanded}}" id="gitlab-{{projectNo}}">
                {{#issues}}
                  <div class="row">
                    <div class="col-md-12">
                      <div class="panel panel-default">
                        <div class="panel-heading">
                          <h3 class="panel-title">
                            <span class="grey">#{{iid}}</span>&nbsp; {{title}}
                            <a target="_blank" href="{{url}}">View on Gitlab</a></h3>
                          </h3>
                        </div>
                        <div class="panel-body">
                          <p>{{description}}</p>
                        </div>
                        <div class="panel-footer">
                          {{#labels.length}}
                            {{#labels}}
                            <span class="label label-primary">{{name}}</span>
                            {{/labels}}
                          {{/labels.length}}
                          &nbsp;&nbsp;
                          {{#assignee}}
                            <span class="label label-default">{{.}}</span>
                          {{/assignee}}
                        </div>
                      </div>
                    </div>
                  </div>
                {{/issues}}
              </div>
              <hr/>
            {{/gitlab}}
          </div>
          <hr/>
          <h2><u>Github ({{totalGithub}})</u></h2>
          <div class="container-fluid" id="allGithub">
            {{#github}}
              <h4>
                <a role="button" data-toggle="collapse" data-parent="#allGithub" href="#github-{{projectNo}}" aria-expanded="true" aria-controls="gitlab-{{projectNo}}">
                  {{project}}  ({{noIssues}})
                </a>&nbsp;&nbsp;
                &nbsp;&nbsp;&nbsp;<a target="_blank" href="{{milestone.url}}" class="repo-link">View on Github</a>
              </h4>
              <div class="container-fluid collapse{{expanded}}" id="github-{{projectNo}}">
                {{#issues}}
                  <div class="row">
                    <div class="col-md-12">
                      <div class="panel panel-default">
                        <div class="panel-heading">
                          <h3 class="panel-title">
                            <span class="grey">#{{iid}}</span>
                            &nbsp; {{title}} &nbsp;
                            <a target="_blank" href="{{url}}">View on Github</a>
                        </div>
                        <div class="panel-body">
                          <p>{{description}}</p>
                        </div>
                        <div class="panel-footer">
                          {{#labels.length}}
                            {{#labels}}
                            <span class="label label-primary">{{name}}</span>
                            {{/labels}}
                          {{/labels.length}}
                          &nbsp;&nbsp;
                          {{#assignee}}
                            <span class="label label-default">{{.}}</span>
                          {{/assignee}}
                        </div>
                      </div>
                    </div>
                  </div>
                {{/issues}}
              </div>
              <hr/>
            {{/github}}
          </div>
        </div>
        <div class="col-md-6 blocking-container">
          <h2><u>Blockers ({{totalBlockers}})</u></h2>
          <div class="container-fluid" id="allBlockers">
            {{#blockers}}
              <h4>
                <a role="button" data-toggle="collapse" data-parent="#allGitlab" href="#blocker-{{index}}" aria-expanded="true" aria-controls="blocker-{{index}}">
                  {{data.title}} ({{data.blockingOpen.length}})
                </a>&nbsp;&nbsp;
                &nbsp;&nbsp;&nbsp;
              </h4>
              <div><a target="_blank" href="{{data.url}}" class="repo-link">{{name}}</a></div>
              <div class="container-fluid collapse{{expanded}}" id="blocker-{{index}}">
                <div class="panel panel-default">
                  <div class="panel-body">
                    <h5>Open ({{data.blockingOpen.length}})</h5>
                    <ul>
                      {{#data.blockingOpen}}
                      <li>{{title}}&nbsp;&nbsp;&nbsp; <a target="_blank" href="{{url}}">{{name}}</a></li>
                      {{/data.blockingOpen}}
                    </ul>
                    <hr/>
                    <h5>Closed ({{data.blockingClosed.length}})</h5>
                    <ul>
                      {{#data.blockingClosed}}
                      <li>{{title}}&nbsp;&nbsp;&nbsp; <a target="_blank" href="{{url}}">{{name}}</a></li>
                      {{/data.blockingClosed}}
                    </ul>
                  </div>
                </div>
              </div>
              <hr/>
            {{/blockers}}
          </div>
        </div>
      </div>
    </div>
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="/static/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.1.6/Chart.min.js"></script>
    <script type="text/javascript">
      $(document).ready(function () {
        var ctx = $('#myChart');
        var chart = new Chart(ctx, {
          type: 'line',
          data: {
            labels: allIssues.map(function (ai) { return ai.date; }),
            datasets: [
              {
                label: 'Total',
                data: allIssues.map(function(ai) { return ai.open; }),
                backgroundColor: 'rgba(255, 99, 132, 0.1)',
                borderColor: 'rgba(255,99,132,1)',
                borderWidth: 1
              },
              {
                label: 'Closed',
                data: allIssues.map(function(ai) { return ai.closed; }),
                backgroundColor: 'rgba(75, 192, 192, 0.3)',
                borderColor: 'rgba(75, 192, 192, 1)',
                borderWidth: 1
              }
            ]
          },
          options: {
            scales: {
              yAxes: [{
                ticks: {
                  beginAtZero: false
                }
              }]
            }
          }
        });
      });
    </script>
  </body>
</html>
